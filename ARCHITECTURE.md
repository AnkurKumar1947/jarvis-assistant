# ğŸ—ï¸ Jarvis Assistant - Architecture

## Overview

Jarvis is a **fully local** AI voice assistant for macOS, built with a modern monorepo structure. It consists of two main applications communicating via WebSocket:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           JARVIS ASSISTANT                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          WebSocket           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                 â”‚  â”‚
â”‚   â”‚    Next.js Web UI   â”‚         (Socket.io)          â”‚  Express Server â”‚  â”‚
â”‚   â”‚    (Port 3000)      â”‚                              â”‚   (Port 3001)   â”‚  â”‚
â”‚   â”‚                     â”‚          REST API            â”‚                 â”‚  â”‚
â”‚   â”‚                     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                 â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚            â”‚                                                    â”‚           â”‚
â”‚            â”‚                                                    â”‚           â”‚
â”‚            â–¼                                                    â–¼           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚   Browser APIs      â”‚                              â”‚  External APIs  â”‚  â”‚
â”‚   â”‚   â€¢ Camera          â”‚                              â”‚  â€¢ Ollama LLM   â”‚  â”‚
â”‚   â”‚   â€¢ Microphone      â”‚                              â”‚  â€¢ macOS System â”‚  â”‚
â”‚   â”‚   â€¢ Web Audio       â”‚                              â”‚  â€¢ Piper TTS    â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## System Architecture

### High-Level Data Flow

```
                              USER INPUT
                                  â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                           â”‚
                    â–¼                           â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  Voice Input â”‚           â”‚  Text Input  â”‚
            â”‚  (Browser)   â”‚           â”‚  (Chat Box)  â”‚
            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                          â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   WebSocket Msg  â”‚
                    â”‚   'send_message' â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚     ASSISTANT SERVICE        â”‚
              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
              â”‚  â”‚   Intent Parser        â”‚  â”‚
              â”‚  â”‚   (Pattern Matching)   â”‚  â”‚
              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
              â”‚              â”‚               â”‚
              â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
              â”‚   â”‚                     â”‚    â”‚
              â”‚   â–¼                     â–¼    â”‚
              â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
              â”‚ â”‚Commands â”‚      â”‚   LLM    â”‚â”‚
              â”‚ â”‚Registry â”‚      â”‚ (Ollama) â”‚â”‚
              â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜â”‚
              â”‚      â”‚                â”‚      â”‚
              â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
              â”‚              â”‚               â”‚
              â”‚              â–¼               â”‚
              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
              â”‚  â”‚   Speech Synthesizer   â”‚  â”‚
              â”‚  â”‚   (Piper / macOS TTS)  â”‚  â”‚
              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   WebSocket Msg  â”‚
                    â”‚    'message'     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚   Web UI    â”‚
                      â”‚  (Display)  â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Frontend Architecture (apps/web)

### Tech Stack
- **Framework**: Next.js 14 (App Router)
- **UI**: React 18 + Tailwind CSS + shadcn/ui
- **State**: Zustand stores
- **Real-time**: Socket.io client
- **Styling**: CSS Variables for theming

### Component Structure

```
apps/web/
â”œâ”€â”€ app/                        # Next.js App Router
â”‚   â”œâ”€â”€ layout.tsx              # Root layout with providers
â”‚   â”œâ”€â”€ page.tsx                # Main dashboard (entry point)
â”‚   â”œâ”€â”€ globals.css             # Global styles + theme variables
â”‚   â””â”€â”€ providers.tsx           # Context providers wrapper
â”‚
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ assistant/              # ğŸ¤– Assistant Panel
â”‚   â”‚   â”œâ”€â”€ AssistantAvatar.tsx    # Animated avatar (idle/listening/speaking)
â”‚   â”‚   â”œâ”€â”€ AssistantView.tsx      # Main assistant display
â”‚   â”‚   â”œâ”€â”€ ControlButtons.tsx     # Voice/mute controls
â”‚   â”‚   â”œâ”€â”€ StateIndicator.tsx     # Current state badge
â”‚   â”‚   â””â”€â”€ Waveform.tsx           # Audio visualization
â”‚   â”‚
â”‚   â”œâ”€â”€ camera/                 # ğŸ“¹ Camera Feed
â”‚   â”‚   â”œâ”€â”€ CameraFeed.tsx         # Live camera display
â”‚   â”‚   â””â”€â”€ CameraControls.tsx     # Camera toggle/settings
â”‚   â”‚
â”‚   â”œâ”€â”€ chat/                   # ğŸ’¬ Chat Interface
â”‚   â”‚   â”œâ”€â”€ ChatPanel.tsx          # Main chat container
â”‚   â”‚   â”œâ”€â”€ ChatInput.tsx          # Message input + send
â”‚   â”‚   â”œâ”€â”€ MessageList.tsx        # Message history
â”‚   â”‚   â”œâ”€â”€ MessageBubble.tsx      # Individual message
â”‚   â”‚   â””â”€â”€ TypingIndicator.tsx    # "Jarvis is typing..."
â”‚   â”‚
â”‚   â”œâ”€â”€ metrics/                # ğŸ“Š System Metrics
â”‚   â”‚   â”œâ”€â”€ SystemMetrics.tsx      # Metrics grid
â”‚   â”‚   â”œâ”€â”€ MetricCard.tsx         # Individual metric
â”‚   â”‚   â”œâ”€â”€ CPUMeter.tsx           # CPU usage ring
â”‚   â”‚   â”œâ”€â”€ RAMMeter.tsx           # Memory usage
â”‚   â”‚   â”œâ”€â”€ DiskMeter.tsx          # Disk usage
â”‚   â”‚   â””â”€â”€ BatteryMeter.tsx       # Battery level
â”‚   â”‚
â”‚   â”œâ”€â”€ settings/               # âš™ï¸ Settings
â”‚   â”‚   â”œâ”€â”€ SettingsDialog.tsx     # Settings modal
â”‚   â”‚   â””â”€â”€ VoiceSettings.tsx      # TTS voice selector
â”‚   â”‚
â”‚   â””â”€â”€ ui/                     # ğŸ¨ Base Components (shadcn)
â”‚       â”œâ”€â”€ button.tsx
â”‚       â”œâ”€â”€ card.tsx
â”‚       â”œâ”€â”€ dialog.tsx
â”‚       â””â”€â”€ ...
â”‚
â”œâ”€â”€ hooks/                      # Custom React Hooks
â”‚   â”œâ”€â”€ useSocket.ts               # WebSocket connection
â”‚   â”œâ”€â”€ useAssistant.ts            # Assistant state management
â”‚   â”œâ”€â”€ useAudioRecorder.ts        # Browser audio recording
â”‚   â”œâ”€â”€ useCamera.ts               # Camera stream access
â”‚   â”œâ”€â”€ useMetrics.ts              # System metrics subscription
â”‚   â””â”€â”€ useTheme.ts                # Theme switching
â”‚
â”œâ”€â”€ stores/                     # Zustand State Stores
â”‚   â”œâ”€â”€ assistantStore.ts          # Assistant state
â”‚   â”œâ”€â”€ chatStore.ts               # Chat messages
â”‚   â”œâ”€â”€ metricsStore.ts            # System metrics
â”‚   â””â”€â”€ themeStore.ts              # Theme preferences
â”‚
â””â”€â”€ lib/
    â”œâ”€â”€ socket.ts                  # Socket.io client setup
    â”œâ”€â”€ constants.ts               # App constants
    â””â”€â”€ utils.ts                   # Utility functions
```

### Frontend State Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        FRONTEND STATE                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ assistantStore  â”‚  â”‚   chatStore     â”‚  â”‚  metricsStore   â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ â€¢ state         â”‚  â”‚ â€¢ messages[]    â”‚  â”‚ â€¢ cpu           â”‚   â”‚
â”‚  â”‚ â€¢ isListening   â”‚  â”‚ â€¢ isTyping      â”‚  â”‚ â€¢ ram           â”‚   â”‚
â”‚  â”‚ â€¢ voice         â”‚  â”‚ â€¢ addMessage()  â”‚  â”‚ â€¢ disk          â”‚   â”‚
â”‚  â”‚ â€¢ ttsEnabled    â”‚  â”‚ â€¢ clearChat()   â”‚  â”‚ â€¢ battery       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â”‚                    â”‚                    â”‚            â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                â”‚                                 â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚                    â”‚    Socket.io Client   â”‚                     â”‚
â”‚                    â”‚  (Real-time Updates)  â”‚                     â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
                          [ Backend Server ]
```

---

## Backend Architecture (apps/server)

### Tech Stack
- **Runtime**: Node.js 18+
- **Framework**: Express.js
- **Real-time**: Socket.io
- **TTS**: Piper (neural) / macOS native
- **LLM**: Ollama (local)
- **Audio**: Sox for recording

### Module Structure

```
apps/server/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts                # ğŸš€ Entry point (Express + Socket.io setup)
â”‚   â”‚
â”‚   â”œâ”€â”€ core/                   # âš™ï¸ Core Configuration
â”‚   â”‚   â”œâ”€â”€ config.ts              # Config loader (JSON)
â”‚   â”‚   â””â”€â”€ types.ts               # TypeScript interfaces
â”‚   â”‚
â”‚   â”œâ”€â”€ socket/                 # ğŸ”Œ WebSocket Layer
â”‚   â”‚   â”œâ”€â”€ index.ts               # Socket.io initialization
â”‚   â”‚   â”œâ”€â”€ handlers.ts            # Event handlers
â”‚   â”‚   â””â”€â”€ events.ts              # Event constants
â”‚   â”‚
â”‚   â”œâ”€â”€ routes/                 # ğŸ›¤ï¸ REST API
â”‚   â”‚   â””â”€â”€ api.ts                 # HTTP endpoints
â”‚   â”‚
â”‚   â”œâ”€â”€ services/               # ğŸ§  Business Logic
â”‚   â”‚   â”œâ”€â”€ assistantService.ts    # Main assistant orchestrator
â”‚   â”‚   â””â”€â”€ metricsService.ts      # System metrics collector
â”‚   â”‚
â”‚   â”œâ”€â”€ brain/                  # ğŸ¤– Intelligence Layer
â”‚   â”‚   â”œâ”€â”€ llm.ts                 # Ollama LLM client
â”‚   â”‚   â”œâ”€â”€ intentParser.ts        # Intent extraction
â”‚   â”‚   â””â”€â”€ memory.ts              # Conversation memory
â”‚   â”‚
â”‚   â”œâ”€â”€ commands/               # âš¡ Command Registry
â”‚   â”‚   â”œâ”€â”€ index.ts               # Command router
â”‚   â”‚   â”œâ”€â”€ system.ts              # Volume, brightness, battery
â”‚   â”‚   â”œâ”€â”€ apps.ts                # Open/close applications
â”‚   â”‚   â”œâ”€â”€ media.ts               # Music playback control
â”‚   â”‚   â””â”€â”€ utilities.ts           # Time, date, calculations
â”‚   â”‚
â”‚   â”œâ”€â”€ speech/                 # ğŸ”Š Speech Processing
â”‚   â”‚   â”œâ”€â”€ synthesizer.ts         # TTS orchestrator
â”‚   â”‚   â”œâ”€â”€ transcriber.ts         # STT (speech-to-text)
â”‚   â”‚   â””â”€â”€ providers/
â”‚   â”‚       â”œâ”€â”€ piperProvider.ts   # Piper neural TTS
â”‚   â”‚       â””â”€â”€ macosProvider.ts   # macOS native TTS
â”‚   â”‚
â”‚   â”œâ”€â”€ audio/                  # ğŸµ Audio Processing
â”‚   â”‚   â”œâ”€â”€ index.ts               # Audio exports
â”‚   â”‚   â”œâ”€â”€ recorder.ts            # Microphone recording
â”‚   â”‚   â”œâ”€â”€ player.ts              # Audio playback
â”‚   â”‚   â””â”€â”€ wakeWord.ts            # Wake word detection
â”‚   â”‚
â”‚   â””â”€â”€ utils/                  # ğŸ”§ Utilities
â”‚       â”œâ”€â”€ logger.ts              # Colored console logging
â”‚       â”œâ”€â”€ macOS.ts               # macOS AppleScript helpers
â”‚       â””â”€â”€ sounds.ts              # System sounds
â”‚
â”œâ”€â”€ config/
â”‚   â””â”€â”€ default.json            # Default configuration
â”‚
â”œâ”€â”€ voices/
â”‚   â””â”€â”€ piper/                  # Piper voice models (.onnx)
â”‚       â”œâ”€â”€ en_GB-alan-medium.onnx
â”‚       â””â”€â”€ manifest.json
â”‚
â””â”€â”€ bin/                        # Binary dependencies
    â”œâ”€â”€ piper                   # Piper TTS binary
    â”œâ”€â”€ piper_phonemize         # Phoneme converter
    â””â”€â”€ espeak-ng-data/         # Language data
```

### Backend Processing Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        BACKEND PROCESSING PIPELINE                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚    User Message                                                             â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â–¼                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                     ASSISTANT SERVICE                               â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚   1. Log user message                                               â”‚    â”‚
â”‚  â”‚   2. Add to conversation memory                                     â”‚    â”‚
â”‚  â”‚   3. Parse intent                                                   â”‚    â”‚
â”‚  â”‚         â”‚                                                           â”‚    â”‚
â”‚  â”‚         â–¼                                                           â”‚    â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    â”‚
â”‚  â”‚   â”‚   Command    â”‚ YES  â”‚   Execute    â”‚      â”‚   Return     â”‚     â”‚    â”‚
â”‚  â”‚   â”‚   Match?     â”‚â”€â”€â”€â”€â”€â–ºâ”‚   Command    â”‚â”€â”€â”€â”€â”€â–ºâ”‚   Result     â”‚     â”‚    â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    â”‚
â”‚  â”‚          â”‚ NO                                                       â”‚    â”‚
â”‚  â”‚          â–¼                                                          â”‚    â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    â”‚
â”‚  â”‚   â”‚   LLM        â”‚ YES  â”‚   Query      â”‚      â”‚   Return     â”‚     â”‚    â”‚
â”‚  â”‚   â”‚   Available? â”‚â”€â”€â”€â”€â”€â–ºâ”‚   Ollama     â”‚â”€â”€â”€â”€â”€â–ºâ”‚   Response   â”‚     â”‚    â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    â”‚
â”‚  â”‚          â”‚ NO                                                       â”‚    â”‚
â”‚  â”‚          â–¼                                                          â”‚    â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚    â”‚
â”‚  â”‚   â”‚  Rule-Based  â”‚â”€â”€â”€â”€â”€â–ºâ”‚   Fallback   â”‚                           â”‚    â”‚
â”‚  â”‚   â”‚  Response    â”‚      â”‚   Response   â”‚                           â”‚    â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚   4. Add response to memory                                         â”‚    â”‚
â”‚  â”‚   5. Emit via WebSocket                                             â”‚    â”‚
â”‚  â”‚   6. Speak via TTS                                                  â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Communication Protocol

### WebSocket Events

#### Client â†’ Server
| Event | Payload | Description |
|-------|---------|-------------|
| `send_message` | `{ content: string, source: 'voice' \| 'text' }` | Send user message |
| `start_listening` | - | Begin voice recording |
| `stop_listening` | - | Stop voice recording |
| `get_metrics` | - | Request system metrics |
| `get_state` | - | Request assistant state |
| `get_history` | - | Request message history |
| `clear_history` | - | Clear conversation |

#### Server â†’ Client
| Event | Payload | Description |
|-------|---------|-------------|
| `message` | `Message` object | New message (user/assistant) |
| `assistant_state` | `AssistantState` string | State change notification |
| `metrics_update` | `SystemMetrics` object | Real-time system metrics |
| `history` | `Message[]` array | Conversation history |
| `error` | `{ code, message }` | Error notification |

### REST API Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/health` | Server health check |
| GET | `/api/status` | Assistant status |
| GET | `/api/metrics` | System metrics |
| POST | `/api/message` | Send message (alternative) |
| GET | `/api/history` | Message history |
| GET | `/api/voices` | Available TTS voices |
| POST | `/api/voices/test` | Test a voice |
| GET/POST | `/api/settings/voice` | Voice settings |

---

## TTS Architecture

The Text-to-Speech system supports multiple providers with automatic fallback:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SPEECH SYNTHESIZER                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Configuration                                                 â”‚
â”‚   â”œâ”€ provider: 'auto' | 'piper' | 'macos'                      â”‚
â”‚   â”œâ”€ voice: string                                              â”‚
â”‚   â””â”€ rate: number                                               â”‚
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚              Provider Selection (auto mode)             â”‚   â”‚
â”‚   â”‚                                                         â”‚   â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    Available?    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚   â”‚   â”‚   Piper     â”‚â”€â”€â”€â”€â”€â”€â”€YESâ”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   Use       â”‚     â”‚   â”‚
â”‚   â”‚   â”‚  Provider   â”‚                  â”‚   Piper     â”‚     â”‚   â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚   â”‚          â”‚ NO                                           â”‚   â”‚
â”‚   â”‚          â–¼                                              â”‚   â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    Available?    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚   â”‚   â”‚   macOS     â”‚â”€â”€â”€â”€â”€â”€â”€YESâ”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   Use       â”‚     â”‚   â”‚
â”‚   â”‚   â”‚  Provider   â”‚                  â”‚   macOS     â”‚     â”‚   â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚   â”‚          â”‚ NO                                           â”‚   â”‚
â”‚   â”‚          â–¼                                              â”‚   â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚   â”‚
â”‚   â”‚   â”‚  No TTS     â”‚                                      â”‚   â”‚
â”‚   â”‚   â”‚  Available  â”‚                                      â”‚   â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚   Piper Provider                    macOS Provider             â”‚
â”‚   â”œâ”€ Neural network voices          â”œâ”€ Native 'say' command    â”‚
â”‚   â”œâ”€ ONNX model files               â”œâ”€ System voices           â”‚
â”‚   â”œâ”€ High quality                   â”œâ”€ No setup required       â”‚
â”‚   â””â”€ Requires model download        â””â”€ Lower quality           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Command System

Commands are pattern-matched and executed by category:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     COMMAND REGISTRY                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚   â”‚   SYSTEM    â”‚   â”‚    APPS     â”‚   â”‚   MEDIA     â”‚          â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚
â”‚   â”‚ â€¢ volume    â”‚   â”‚ â€¢ open      â”‚   â”‚ â€¢ play      â”‚          â”‚
â”‚   â”‚ â€¢ mute      â”‚   â”‚ â€¢ close     â”‚   â”‚ â€¢ pause     â”‚          â”‚
â”‚   â”‚ â€¢ battery   â”‚   â”‚ â€¢ list      â”‚   â”‚ â€¢ next      â”‚          â”‚
â”‚   â”‚ â€¢ brightnessâ”‚   â”‚ â€¢ focus     â”‚   â”‚ â€¢ previous  â”‚          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚   â”‚  UTILITIES  â”‚   â”‚CONVERSATION â”‚                            â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                            â”‚
â”‚   â”‚ â€¢ time      â”‚   â”‚ â€¢ greetings â”‚                            â”‚
â”‚   â”‚ â€¢ date      â”‚   â”‚ â€¢ help      â”‚                            â”‚
â”‚   â”‚ â€¢ calculate â”‚   â”‚ â€¢ identity  â”‚                            â”‚
â”‚   â”‚ â€¢ search    â”‚   â”‚ â€¢ fallback  â”‚                            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                                                                 â”‚
â”‚   Pattern Matching:                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚ "set volume to 50" â†’ /set\s+volume\s+(?:to\s+)?(\d+)/     â”‚ â”‚
â”‚   â”‚ "open Safari"      â†’ /open\s+(\w+)/                       â”‚ â”‚
â”‚   â”‚ "what time is it"  â†’ /(?:what|what's|whats).*time/        â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## State Machine

The assistant operates as a finite state machine:

```
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚ INITIALIZING â”‚
                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚ Config loaded
                                     â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                                                          â”‚
     â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
     â”‚   â”‚                                                â”‚     â”‚
     â”‚   â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”                               â”‚     â”‚
     â”‚   â”‚         â”‚      â”‚                               â”‚     â”‚
     â”‚   â”‚         â”‚ IDLE â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚
     â”‚   â”‚         â”‚      â”‚                            â”‚  â”‚     â”‚
     â”‚   â”‚         â””â”€â”€â”¬â”€â”€â”€â”˜                            â”‚  â”‚     â”‚
     â”‚   â”‚            â”‚ User speaks/types              â”‚  â”‚     â”‚
     â”‚   â”‚            â–¼                                â”‚  â”‚     â”‚
     â”‚   â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚  â”‚     â”‚
     â”‚   â”‚      â”‚ LISTENING â”‚ (voice mode)             â”‚  â”‚     â”‚
     â”‚   â”‚      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                          â”‚  â”‚     â”‚
     â”‚   â”‚            â”‚ Audio captured                 â”‚  â”‚     â”‚
     â”‚   â”‚            â–¼                                â”‚  â”‚     â”‚
     â”‚   â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚  â”‚     â”‚
     â”‚   â”‚      â”‚ PROCESSING â”‚ (transcription)         â”‚  â”‚     â”‚
     â”‚   â”‚      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                         â”‚  â”‚     â”‚
     â”‚   â”‚            â”‚ Text extracted                 â”‚  â”‚     â”‚
     â”‚   â”‚            â–¼                                â”‚  â”‚     â”‚
     â”‚   â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚  â”‚     â”‚
     â”‚   â”‚      â”‚ THINKING â”‚ (LLM/intent)              â”‚  â”‚     â”‚
     â”‚   â”‚      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                           â”‚  â”‚     â”‚
     â”‚   â”‚           â”‚                                 â”‚  â”‚     â”‚
     â”‚   â”‚  Command? â”‚                                 â”‚  â”‚     â”‚
     â”‚   â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                          â”‚  â”‚     â”‚
     â”‚   â”‚    â”‚             â”‚                          â”‚  â”‚     â”‚
     â”‚   â”‚    â–¼             â–¼                          â”‚  â”‚     â”‚
     â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  (skip)                       â”‚  â”‚     â”‚
     â”‚   â”‚ â”‚ EXECUTING â”‚                               â”‚  â”‚     â”‚
     â”‚   â”‚ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                               â”‚  â”‚     â”‚
     â”‚   â”‚       â”‚                                     â”‚  â”‚     â”‚
     â”‚   â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”‚
     â”‚   â”‚                  â”‚ Response ready              â”‚     â”‚
     â”‚   â”‚                  â–¼                             â”‚     â”‚
     â”‚   â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚     â”‚
     â”‚   â”‚            â”‚ SPEAKING â”‚ (TTS output)           â”‚     â”‚
     â”‚   â”‚            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                        â”‚     â”‚
     â”‚   â”‚                 â”‚ Speech complete              â”‚     â”‚
     â”‚   â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º(back to IDLE) â”‚     â”‚
     â”‚   â”‚                                                â”‚     â”‚
     â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
     â”‚                                                          â”‚
     â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”                         â”‚
     â”‚                        â”‚ ERROR â”‚ (recoverable)           â”‚
     â”‚                        â””â”€â”€â”€â”¬â”€â”€â”€â”˜                         â”‚
     â”‚                            â”‚ Auto-recovery               â”‚
     â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º(back to IDLE)    â”‚
     â”‚                                                          â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â”‚ SIGTERM/SIGINT
                                     â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚ SHUTDOWN â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## External Dependencies

### Required
| Dependency | Purpose | Installation |
|------------|---------|--------------|
| Node.js 18+ | Runtime | `brew install node` |
| npm | Package manager | (included with Node.js) |

### Optional (Enhanced Features)
| Dependency | Purpose | Installation |
|------------|---------|--------------|
| Ollama | Local LLM | `brew install ollama` |
| Piper | Neural TTS | `brew install piper` |
| Sox | Audio recording | `brew install sox` |
| Piper voices | Voice models | `./scripts/download-piper-voices.sh` |

---

## Configuration

Configuration is loaded from `apps/server/config/default.json`:

```json
{
  "assistant": {
    "name": "Jarvis",
    "wakeWord": "jarvis",
    "language": "en"
  },
  "ollama": {
    "host": "http://localhost:11434",
    "model": "llama3.2:3b",
    "timeout": 60000
  },
  "tts": {
    "provider": "auto",
    "voice": "en_GB-alan-medium",
    "rate": 1.0,
    "enabled": true
  },
  "commands": {
    "enableSystem": true,
    "enableApps": true,
    "enableMedia": true,
    "enableUtilities": true
  }
}
```

---

## Security Considerations

- **Fully Local**: All processing happens on your machine
- **No Cloud APIs**: LLM (Ollama) and TTS (Piper) run locally
- **No Telemetry**: No data sent to external servers
- **macOS Permissions**: Requires microphone and accessibility access for full functionality

---

## Future Architecture (Planned)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FUTURE ENHANCEMENTS                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚   â”‚  Mobile App     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â–º [ WebSocket ]                  â”‚
â”‚   â”‚  (React Native) â”‚                                          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚   â”‚  Smart Home     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â–º [ HomeKit / Home Assistant ]   â”‚
â”‚   â”‚  Integration    â”‚                                          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚   â”‚  Camera AI      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â–º [ Vision Models / YOLO ]       â”‚
â”‚   â”‚  Processing     â”‚                                          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚   â”‚  Plugin System  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â–º [ Custom Commands / Skills ]   â”‚
â”‚   â”‚                 â”‚                                          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Quick Reference

### Start Development
```bash
# Terminal 1: Backend
cd apps/server && npm run dev

# Terminal 2: Frontend
cd apps/web && npm run dev
```

### Key Files
| Purpose | File |
|---------|------|
| Server entry | `apps/server/src/index.ts` |
| Main orchestrator | `apps/server/src/services/assistantService.ts` |
| WebSocket handlers | `apps/server/src/socket/handlers.ts` |
| Frontend entry | `apps/web/app/page.tsx` |
| Socket client | `apps/web/lib/socket.ts` |
| Type definitions | `apps/server/src/core/types.ts` |
